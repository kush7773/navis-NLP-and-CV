<!DOCTYPE html>
<html lang="en">

<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>NAVIS Control Center | Robomanthan √ó BNMIT</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
                rel="stylesheet">
        <style>
                * {
                        margin: 0;
                        padding: 0;
                        box-sizing: border-box;
                        -webkit-tap-highlight-color: transparent;
                }

                body {
                        font-family: 'Inter', system-ui, -apple-system, sans-serif;
                        background: #0a0a0f;
                        color: #e0e0e0;
                        overflow-x: hidden;
                        min-height: 100vh;
                }

                /* ============================================
           HEADER - Professional with Logos
           ============================================ */
                .header {
                        background: linear-gradient(180deg, rgba(15, 15, 25, 0.98) 0%, rgba(10, 10, 15, 0.95) 100%);
                        backdrop-filter: blur(20px);
                        padding: 12px 24px;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        border-bottom: 1px solid rgba(255, 215, 0, 0.3);
                        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
                        position: sticky;
                        top: 0;
                        z-index: 100;
                }

                .header-left {
                        display: flex;
                        align-items: center;
                        gap: 14px;
                }

                .header-logo {
                        width: 48px;
                        height: 48px;
                        border-radius: 50%;
                        object-fit: cover;
                        border: 2px solid #FFD700;
                        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
                }

                .header-title {
                        display: flex;
                        flex-direction: column;
                }

                .header-title h1 {
                        font-size: 20px;
                        font-weight: 800;
                        letter-spacing: 2px;
                        background: linear-gradient(135deg, #FFD700, #FFA500);
                        -webkit-background-clip: text;
                        -webkit-text-fill-color: transparent;
                        line-height: 1.2;
                }

                .header-title .subtitle {
                        font-size: 10px;
                        font-weight: 500;
                        color: rgba(255, 215, 0, 0.6);
                        letter-spacing: 1.5px;
                        text-transform: uppercase;
                }

                .header-right {
                        display: flex;
                        align-items: center;
                        gap: 12px;
                }

                .header-logo-secondary {
                        width: 42px;
                        height: 42px;
                        border-radius: 50%;
                        object-fit: cover;
                        border: 2px solid #E8731A;
                        box-shadow: 0 0 10px rgba(232, 115, 26, 0.3);
                }

                .status-badge {
                        padding: 6px 14px;
                        border-radius: 20px;
                        font-size: 11px;
                        font-weight: 700;
                        border: 1.5px solid;
                        transition: all 0.3s ease;
                        letter-spacing: 0.5px;
                }

                .status-badge.active {
                        background: rgba(0, 255, 136, 0.15);
                        border-color: #00ff88;
                        color: #00ff88;
                        animation: glow-green 2s infinite;
                }

                .status-badge.inactive {
                        background: rgba(255, 107, 107, 0.15);
                        border-color: #ff6b6b;
                        color: #ff6b6b;
                }

                @keyframes glow-green {

                        0%,
                        100% {
                                box-shadow: 0 0 8px rgba(0, 255, 136, 0.4);
                        }

                        50% {
                                box-shadow: 0 0 18px rgba(0, 255, 136, 0.7);
                        }
                }

                /* ============================================
           TAB NAVIGATION
           ============================================ */
                .tab-nav {
                        display: flex;
                        background: rgba(15, 15, 25, 0.9);
                        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
                        overflow-x: auto;
                        scrollbar-width: none;
                }

                .tab-nav::-webkit-scrollbar {
                        display: none;
                }

                .tab-btn {
                        flex: 1;
                        min-width: 80px;
                        padding: 12px 8px;
                        background: none;
                        border: none;
                        color: rgba(255, 255, 255, 0.4);
                        font-family: 'Inter', sans-serif;
                        font-size: 11px;
                        font-weight: 600;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        border-bottom: 2px solid transparent;
                        text-align: center;
                        letter-spacing: 0.3px;
                        white-space: nowrap;
                }

                .tab-btn:hover {
                        color: rgba(255, 255, 255, 0.7);
                        background: rgba(255, 255, 255, 0.03);
                }

                .tab-btn.active {
                        color: #FFD700;
                        border-bottom-color: #FFD700;
                        background: rgba(255, 215, 0, 0.05);
                }

                .tab-btn .tab-icon {
                        display: block;
                        font-size: 18px;
                        margin-bottom: 4px;
                }

                /* ============================================
           TAB CONTENT
           ============================================ */
                .tab-content {
                        display: none;
                        padding: 16px;
                        animation: fadeIn 0.3s ease;
                }

                .tab-content.active {
                        display: block;
                }

                @keyframes fadeIn {
                        from {
                                opacity: 0;
                                transform: translateY(8px);
                        }

                        to {
                                opacity: 1;
                                transform: translateY(0);
                        }
                }

                /* ============================================
           PANELS
           ============================================ */
                .panel {
                        background: linear-gradient(135deg, rgba(20, 20, 35, 0.9) 0%, rgba(15, 15, 25, 0.9) 100%);
                        backdrop-filter: blur(10px);
                        border-radius: 16px;
                        padding: 20px;
                        border: 1px solid rgba(255, 255, 255, 0.06);
                        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                        margin-bottom: 16px;
                }

                .panel-title {
                        font-size: 14px;
                        font-weight: 700;
                        margin-bottom: 16px;
                        color: #FFD700;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        text-transform: uppercase;
                        letter-spacing: 1px;
                }

                .grid-2 {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 12px;
                }

                @media (max-width: 480px) {
                        .grid-2-responsive {
                                grid-template-columns: 1fr;
                        }
                }

                /* ============================================
           CAMERA FEED
           ============================================ */
                .camera-feed {
                        width: 100%;
                        border-radius: 12px;
                        border: 1px solid rgba(255, 215, 0, 0.2);
                        box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
                        background: #000;
                }

                .camera-placeholder {
                        background: #000;
                        height: 240px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 12px;
                        color: rgba(255, 255, 255, 0.3);
                        font-size: 14px;
                }

                /* ============================================
           BUTTONS - Universal Styles
           ============================================ */
                .btn {
                        padding: 12px 16px;
                        border: 1.5px solid;
                        background: rgba(255, 255, 255, 0.03);
                        border-radius: 10px;
                        cursor: pointer;
                        font-family: 'Inter', sans-serif;
                        font-weight: 600;
                        font-size: 13px;
                        transition: all 0.2s ease;
                        text-align: center;
                        user-select: none;
                }

                .btn:active {
                        transform: scale(0.95);
                }

                .btn-gold {
                        border-color: rgba(255, 215, 0, 0.4);
                        color: #FFD700;
                }

                .btn-gold:active {
                        background: rgba(255, 215, 0, 0.15);
                        box-shadow: 0 0 15px rgba(255, 215, 0, 0.3);
                }

                .btn-green {
                        border-color: rgba(0, 255, 136, 0.4);
                        color: #00ff88;
                }

                .btn-green:active {
                        background: rgba(0, 255, 136, 0.15);
                        box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
                }

                .btn-red {
                        border-color: rgba(255, 107, 107, 0.4);
                        color: #ff6b6b;
                }

                .btn-red:active {
                        background: rgba(255, 107, 107, 0.15);
                        box-shadow: 0 0 15px rgba(255, 107, 107, 0.3);
                }

                .btn-cyan {
                        border-color: rgba(0, 212, 255, 0.4);
                        color: #00d4ff;
                }

                .btn-cyan:active {
                        background: rgba(0, 212, 255, 0.15);
                        box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
                }

                .btn-purple {
                        border-color: rgba(168, 85, 247, 0.4);
                        color: #a855f7;
                }

                .btn-purple:active {
                        background: rgba(168, 85, 247, 0.15);
                        box-shadow: 0 0 15px rgba(168, 85, 247, 0.3);
                }

                .btn-fill-gold {
                        border: none;
                        background: linear-gradient(135deg, #FFD700, #FFA500);
                        color: #0a0a0f;
                        font-weight: 700;
                }

                .btn-fill-gold:active {
                        box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
                }

                /* ============================================
           JOYSTICK
           ============================================ */
                .joystick {
                        display: grid;
                        grid-template-columns: repeat(3, 70px);
                        grid-template-rows: repeat(3, 70px);
                        gap: 8px;
                        margin: 16px auto;
                        justify-content: center;
                }

                .joy-btn {
                        border: 2px solid rgba(255, 215, 0, 0.3);
                        background: rgba(255, 215, 0, 0.05);
                        border-radius: 14px;
                        cursor: pointer;
                        font-size: 24px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        transition: all 0.15s ease;
                        user-select: none;
                        color: #FFD700;
                }

                .joy-btn:active {
                        transform: scale(0.9);
                        background: rgba(255, 215, 0, 0.2);
                        box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
                }

                .joy-btn.stop {
                        background: rgba(255, 107, 107, 0.1);
                        border-color: rgba(255, 107, 107, 0.4);
                        color: #ff6b6b;
                        font-size: 12px;
                        font-weight: 800;
                        font-family: 'Inter', sans-serif;
                }

                .emergency-stop {
                        width: 100%;
                        padding: 16px;
                        background: linear-gradient(135deg, #dc2626, #b91c1c);
                        border: none;
                        border-radius: 12px;
                        color: white;
                        font-family: 'Inter', sans-serif;
                        font-size: 16px;
                        font-weight: 800;
                        cursor: pointer;
                        letter-spacing: 1px;
                        transition: all 0.2s ease;
                }

                .emergency-stop:active {
                        transform: scale(0.97);
                        box-shadow: 0 0 30px rgba(220, 38, 38, 0.6);
                }

                /* ============================================
           VOICE / CHAT
           ============================================ */
                .mic-button {
                        width: 100px;
                        height: 100px;
                        border-radius: 50%;
                        border: none;
                        background: linear-gradient(135deg, #FFD700, #FFA500);
                        color: #0a0a0f;
                        font-size: 40px;
                        cursor: pointer;
                        box-shadow: 0 8px 25px rgba(255, 215, 0, 0.3);
                        transition: all 0.3s ease;
                        margin: 16px auto;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                }

                .mic-button:active {
                        transform: scale(0.9);
                }

                .mic-button.recording {
                        background: linear-gradient(135deg, #dc2626, #b91c1c);
                        color: white;
                        animation: pulse 1.5s infinite;
                }

                @keyframes pulse {

                        0%,
                        100% {
                                transform: scale(1);
                                box-shadow: 0 0 20px rgba(220, 38, 38, 0.4);
                        }

                        50% {
                                transform: scale(1.08);
                                box-shadow: 0 0 35px rgba(220, 38, 38, 0.7);
                        }
                }

                .status-display {
                        background: rgba(0, 0, 0, 0.4);
                        padding: 16px;
                        border-radius: 12px;
                        min-height: 80px;
                        font-size: 13px;
                        line-height: 1.7;
                        border: 1px solid rgba(255, 255, 255, 0.04);
                }

                .text-input-group {
                        display: flex;
                        gap: 8px;
                        margin-top: 12px;
                }

                .text-input {
                        flex: 1;
                        padding: 12px 16px;
                        border: 1.5px solid rgba(255, 255, 255, 0.1);
                        background: rgba(0, 0, 0, 0.4);
                        border-radius: 10px;
                        color: white;
                        font-family: 'Inter', sans-serif;
                        font-size: 13px;
                }

                .text-input:focus {
                        outline: none;
                        border-color: #FFD700;
                        box-shadow: 0 0 10px rgba(255, 215, 0, 0.2);
                }

                /* ============================================
           HAND CONTROLS
           ============================================ */
                .hand-section-label {
                        text-align: center;
                        font-weight: 700;
                        font-size: 12px;
                        letter-spacing: 1px;
                        margin-bottom: 8px;
                        text-transform: uppercase;
                }

                .hand-section-label.left {
                        color: #00d4ff;
                }

                .hand-section-label.right {
                        color: #00ff88;
                }

                .slider-group {
                        margin-bottom: 16px;
                }

                .slider-label {
                        display: flex;
                        justify-content: space-between;
                        margin-bottom: 8px;
                        font-size: 12px;
                        font-weight: 600;
                }

                .angle-display {
                        font-weight: 700;
                        font-size: 14px;
                        color: #FFD700;
                }

                .slider {
                        width: 100%;
                        height: 6px;
                        border-radius: 3px;
                        background: rgba(255, 255, 255, 0.08);
                        outline: none;
                        -webkit-appearance: none;
                }

                .slider::-webkit-slider-thumb {
                        -webkit-appearance: none;
                        width: 22px;
                        height: 22px;
                        border-radius: 50%;
                        background: #FFD700;
                        cursor: pointer;
                        box-shadow: 0 0 10px rgba(255, 215, 0, 0.4);
                }

                /* ============================================
           TRAINING SECTION
           ============================================ */
                .training-status {
                        padding: 10px 14px;
                        background: rgba(0, 0, 0, 0.3);
                        border-radius: 10px;
                        text-align: center;
                        font-weight: 700;
                        font-size: 13px;
                        border: 1.5px solid;
                }

                .training-status.enrolled {
                        color: #00ff88;
                        border-color: rgba(0, 255, 136, 0.3);
                }

                .training-status.not-enrolled {
                        color: #ff6b6b;
                        border-color: rgba(255, 107, 107, 0.3);
                }

                .views-list {
                        font-size: 11px;
                        opacity: 0.6;
                        text-align: center;
                        margin-top: 6px;
                }

                /* ============================================
           MODEL TRAINING MODAL
           ============================================ */
                .train-form {
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                }

                .train-form textarea {
                        width: 100%;
                        padding: 12px;
                        border: 1.5px solid rgba(255, 255, 255, 0.1);
                        background: rgba(0, 0, 0, 0.4);
                        border-radius: 10px;
                        color: white;
                        font-family: 'Inter', sans-serif;
                        font-size: 13px;
                        resize: vertical;
                        min-height: 50px;
                }

                .train-form textarea:focus {
                        outline: none;
                        border-color: #a855f7;
                        box-shadow: 0 0 10px rgba(168, 85, 247, 0.2);
                }

                .training-pair {
                        display: flex;
                        justify-content: space-between;
                        align-items: flex-start;
                        padding: 10px 12px;
                        background: rgba(0, 0, 0, 0.3);
                        border-radius: 8px;
                        margin-bottom: 6px;
                        border: 1px solid rgba(255, 255, 255, 0.04);
                        font-size: 12px;
                }

                .training-pair .pair-content {
                        flex: 1;
                        margin-right: 10px;
                }

                .training-pair .pair-q {
                        color: #FFD700;
                        font-weight: 600;
                        margin-bottom: 3px;
                }

                .training-pair .pair-a {
                        color: rgba(255, 255, 255, 0.6);
                }

                .training-pair .delete-pair {
                        background: none;
                        border: none;
                        color: #ff6b6b;
                        cursor: pointer;
                        font-size: 16px;
                        padding: 2px 6px;
                        border-radius: 4px;
                        transition: background 0.2s;
                }

                .training-pair .delete-pair:hover {
                        background: rgba(255, 107, 107, 0.15);
                }

                .training-list {
                        max-height: 300px;
                        overflow-y: auto;
                        margin-top: 12px;
                }

                .training-list::-webkit-scrollbar {
                        width: 4px;
                }

                .training-list::-webkit-scrollbar-track {
                        background: rgba(255, 255, 255, 0.02);
                }

                .training-list::-webkit-scrollbar-thumb {
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 2px;
                }

                /* ============================================
           SPINNER & UTILITY
           ============================================ */
                .spinner {
                        display: inline-block;
                        width: 14px;
                        height: 14px;
                        border: 2px solid rgba(255, 255, 255, 0.2);
                        border-top-color: #FFD700;
                        border-radius: 50%;
                        animation: spin 0.8s linear infinite;
                }

                @keyframes spin {
                        to {
                                transform: rotate(360deg);
                        }
                }

                input[type="file"] {
                        display: none;
                }

                .text-center {
                        text-align: center;
                }

                .mt-8 {
                        margin-top: 8px;
                }

                .mt-12 {
                        margin-top: 12px;
                }

                .quick-commands {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 8px;
                        margin-bottom: 12px;
                }

                /* ============================================
                   FLOATING EMERGENCY STOP (ALL TABS)
                   ============================================ */
                .global-emergency {
                        position: fixed;
                        bottom: 20px;
                        right: 20px;
                        width: 64px;
                        height: 64px;
                        border-radius: 50%;
                        background: linear-gradient(135deg, #dc2626, #991b1b);
                        border: 3px solid #ff6b6b;
                        color: white;
                        font-size: 28px;
                        cursor: pointer;
                        z-index: 999;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 4px 20px rgba(220, 38, 38, 0.5);
                        transition: all 0.2s ease;
                        animation: emergency-glow 2s infinite;
                }

                .global-emergency:active {
                        transform: scale(0.9);
                        box-shadow: 0 0 40px rgba(220, 38, 38, 0.8);
                }

                @keyframes emergency-glow {

                        0%,
                        100% {
                                box-shadow: 0 4px 20px rgba(220, 38, 38, 0.4);
                        }

                        50% {
                                box-shadow: 0 4px 30px rgba(220, 38, 38, 0.7);
                        }
                }

                /* ============================================
                   STOP SPEAKING BUTTON
                   ============================================ */
                .stop-speaking-btn {
                        display: none;
                        width: 100%;
                        padding: 12px;
                        margin-top: 10px;
                        background: linear-gradient(135deg, #dc2626, #b91c1c);
                        border: none;
                        border-radius: 10px;
                        color: white;
                        font-family: 'Inter', sans-serif;
                        font-size: 14px;
                        font-weight: 700;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        letter-spacing: 0.5px;
                }

                .stop-speaking-btn.visible {
                        display: block;
                        animation: fadeIn 0.3s ease;
                }

                .stop-speaking-btn:active {
                        transform: scale(0.97);
                }

                /* ============================================
                   CHAT MESSAGES
                   ============================================ */
                .chat-messages {
                        max-height: 350px;
                        overflow-y: auto;
                        padding: 8px 0;
                }

                .chat-msg {
                        padding: 10px 14px;
                        border-radius: 12px;
                        margin-bottom: 8px;
                        font-size: 13px;
                        line-height: 1.5;
                        animation: fadeIn 0.3s ease;
                }

                .chat-msg.user {
                        background: rgba(255, 215, 0, 0.08);
                        border: 1px solid rgba(255, 215, 0, 0.15);
                        margin-left: 20%;
                }

                .chat-msg.bot {
                        background: rgba(0, 255, 136, 0.06);
                        border: 1px solid rgba(0, 255, 136, 0.12);
                        margin-right: 20%;
                }

                .chat-msg .msg-label {
                        font-weight: 700;
                        font-size: 11px;
                        margin-bottom: 4px;
                        text-transform: uppercase;
                        letter-spacing: 0.5px;
                }

                .chat-msg.user .msg-label {
                        color: #FFD700;
                }

                .chat-msg.bot .msg-label {
                        color: #00ff88;
                }

                .speaking-indicator {
                        display: inline-block;
                        margin-left: 6px;
                        animation: pulse 1s infinite;
                        font-size: 12px;
                }

                /* ============================================
                   FOLLOW MODE CONTROLS (Camera Tab)
                   ============================================ */
                .follow-controls {
                        display: grid;
                        grid-template-columns: 1fr 1fr;
                        gap: 10px;
                        margin-top: 12px;
                }

                .follow-btn {
                        padding: 14px;
                        border-radius: 12px;
                        font-family: 'Inter', sans-serif;
                        font-weight: 700;
                        font-size: 14px;
                        cursor: pointer;
                        transition: all 0.2s ease;
                        text-align: center;
                        letter-spacing: 0.5px;
                }

                .follow-btn.follow {
                        background: rgba(0, 255, 136, 0.08);
                        border: 2px solid rgba(0, 255, 136, 0.4);
                        color: #00ff88;
                }

                .follow-btn.follow:active {
                        background: rgba(0, 255, 136, 0.2);
                        box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
                }

                .follow-btn.follow.active {
                        background: rgba(0, 255, 136, 0.2);
                        box-shadow: 0 0 15px rgba(0, 255, 136, 0.3);
                        animation: glow-green 2s infinite;
                }

                .follow-btn.stop-follow {
                        background: rgba(255, 107, 107, 0.08);
                        border: 2px solid rgba(255, 107, 107, 0.4);
                        color: #ff6b6b;
                }

                .follow-btn.stop-follow:active {
                        background: rgba(255, 107, 107, 0.2);
                        box-shadow: 0 0 20px rgba(255, 107, 107, 0.4);
                }

                /* Mobile responsive */
                @media (max-width: 480px) {
                        .header {
                                padding: 10px 16px;
                        }

                        .header-logo {
                                width: 36px;
                                height: 36px;
                        }

                        .header-logo-secondary {
                                width: 32px;
                                height: 32px;
                        }

                        .header-title h1 {
                                font-size: 16px;
                        }

                        .tab-btn {
                                font-size: 10px;
                                padding: 10px 6px;
                        }

                        .tab-btn .tab-icon {
                                font-size: 16px;
                        }

                        .joystick {
                                grid-template-columns: repeat(3, 60px);
                                grid-template-rows: repeat(3, 60px);
                        }

                        .global-emergency {
                                width: 56px;
                                height: 56px;
                                bottom: 16px;
                                right: 16px;
                                font-size: 24px;
                        }

                        .chat-msg.user {
                                margin-left: 10%;
                        }

                        .chat-msg.bot {
                                margin-right: 10%;
                        }
                }
        </style>
</head>

<body>
        <!-- HEADER -->
        <div class="header">
                <div class="header-left">
                        <img src="/static/robomanthan_logo.png" alt="Robomanthan" class="header-logo"
                                onerror="this.style.display='none'">
                        <div class="header-title">
                                <h1>NAVIS</h1>
                                <span class="subtitle">Robomanthan √ó BNMIT</span>
                        </div>
                </div>
                <div class="header-right">
                        <div class="status-badge inactive" id="followStatus">‚è∏Ô∏è MANUAL</div>
                        <img src="/static/bnmit_logo.png" alt="BNMIT" class="header-logo-secondary"
                                onerror="this.style.display='none'">
                </div>
        </div>

        <!-- TAB NAVIGATION -->
        <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('control')">
                        <span class="tab-icon">üïπÔ∏è</span>Control
                </button>
                <button class="tab-btn" onclick="switchTab('camera')">
                        <span class="tab-icon">üìπ</span>Camera
                </button>
                <button class="tab-btn" onclick="switchTab('voice')">
                        <span class="tab-icon">üé§</span>Voice
                </button>
                <button class="tab-btn" onclick="switchTab('hands')">
                        <span class="tab-icon">üñêÔ∏è</span>Hands
                </button>
                <button class="tab-btn" onclick="switchTab('training')">
                        <span class="tab-icon">üß†</span>Train
                </button>
        </div>

        <!-- ============================================
         TAB 1: CONTROL (Joystick + Quick Commands)
         ============================================ -->
        <div class="tab-content active" id="tab-control">
                <div class="panel">
                        <div class="panel-title">üïπÔ∏è Movement Control</div>
                        <div class="joystick">
                                <div></div>
                                <div class="joy-btn" onmousedown="startMoving('F')" onmouseup="stopMoving()"
                                        ontouchstart="startMoving('F')" ontouchend="stopMoving()"
                                        onmouseleave="stopMoving()">‚Üë</div>
                                <div></div>
                                <div class="joy-btn" onmousedown="startMoving('L')" onmouseup="stopMoving()"
                                        ontouchstart="startMoving('L')" ontouchend="stopMoving()"
                                        onmouseleave="stopMoving()">‚Üê</div>
                                <div class="joy-btn stop" onclick="stopMoving()">STOP</div>
                                <div class="joy-btn" onmousedown="startMoving('R')" onmouseup="stopMoving()"
                                        ontouchstart="startMoving('R')" ontouchend="stopMoving()"
                                        onmouseleave="stopMoving()">‚Üí</div>
                                <div></div>
                                <div class="joy-btn" onmousedown="startMoving('B')" onmouseup="stopMoving()"
                                        ontouchstart="startMoving('B')" ontouchend="stopMoving()"
                                        onmouseleave="stopMoving()">‚Üì</div>
                                <div></div>
                        </div>
                        <button class="emergency-stop" onclick="emergencyStop()">üõë EMERGENCY STOP</button>
                </div>

                <div class="panel">
                        <div class="status-display" id="controlStatus">
                                <strong>Ready</strong>
                                <p style="opacity: 0.5; margin-top: 6px; font-size: 12px;">
                                        Use joystick to move ‚Ä¢ Emergency stop is always available
                                </p>
                        </div>
                </div>
        </div>

        <!-- ============================================
         TAB 2: CAMERA (Feed + Person Training)
         ============================================ -->
        <div class="tab-content" id="tab-camera">
                <div class="panel">
                        <div class="panel-title">üìπ Live Camera Feed</div>
                        {% if camera_available %}
                        <img src="{{ url_for('video_feed') }}" class="camera-feed" alt="Camera Feed">
                        <div class="grid-2 mt-12">
                                <button class="btn btn-gold" id="faceDetectBtn" onclick="toggleFaceDetection()">
                                        üë§ Face Detection
                                </button>
                        </div>
                        {% else %}
                        <div class="camera-placeholder">üìπ Camera Not Available</div>
                        {% endif %}

                        <!-- Follow / Stop Controls -->
                        <div class="follow-controls">
                                <button class="follow-btn follow" id="followBtn" onclick="toggleFollow(true)">
                                        üéØ Follow Me NAVIS
                                </button>
                                <button class="follow-btn stop-follow" id="stopFollowBtn" onclick="toggleFollow(false)">
                                        ‚èπÔ∏è Stop NAVIS
                                </button>
                        </div>
                        <div class="status-display mt-12" id="cameraStatus">
                                <strong>Camera ready</strong>
                                <p style="opacity: 0.5; margin-top: 4px; font-size: 12px;">Use Follow/Stop to control
                                        person tracking</p>
                        </div>
                </div>

                <div class="panel">
                        <div class="panel-title">üë§ Person Training</div>
                        <div class="training-status not-enrolled" id="trainingStatus">‚ö†Ô∏è No person enrolled</div>
                        <div class="views-list" id="viewsList"></div>

                        <div class="grid-2 mt-12">
                                <button class="btn btn-green" onclick="captureView('front')">üì∏ Front View</button>
                                <button class="btn btn-green" onclick="captureView('back')">üì∏ Back View</button>
                        </div>

                        <input type="file" id="photoUploadFront" accept="image/*" onchange="uploadPhoto('front')">
                        <input type="file" id="photoUploadBack" accept="image/*" onchange="uploadPhoto('back')">

                        <div class="grid-2 mt-8">
                                <button class="btn btn-cyan"
                                        onclick="document.getElementById('photoUploadFront').click()">
                                        üìÅ Upload Front
                                </button>
                                <button class="btn btn-cyan"
                                        onclick="document.getElementById('photoUploadBack').click()">
                                        üìÅ Upload Back
                                </button>
                        </div>

                        <button class="btn btn-red mt-12" style="width:100%" onclick="clearPerson()">üóëÔ∏è Clear
                                Training</button>
                </div>
        </div>

        <!-- ============================================
         TAB 3: VOICE & CHAT
         ============================================ -->
        <div class="tab-content" id="tab-voice">
                <div class="panel">
                        <div class="panel-title">üé§ Voice Control</div>
                        <div class="text-center">
                                <button class="mic-button" id="micBtn">üé§</button>
                                <p style="font-size: 11px; opacity: 0.4; margin-top: 8px;">Hold to speak</p>
                        </div>
                        <button class="stop-speaking-btn" id="stopSpeakingBtn" onclick="stopSpeaking()">
                                üîá Stop Speaking
                        </button>
                </div>

                <div class="panel">
                        <div class="panel-title">üí¨ Chat</div>
                        <div class="chat-messages" id="chatMessages">
                                <div class="chat-msg bot">
                                        <div class="msg-label">ü§ñ NAVIS</div>
                                        Hello! I'm NAVIS. Ask me anything by voice or text.
                                </div>
                        </div>
                        <div class="text-input-group">
                                <input type="text" class="text-input" id="textInput"
                                        placeholder="Type command or question...">
                                <button class="btn btn-fill-gold" onclick="sendText()">Send</button>
                        </div>
                </div>
        </div>

        <!-- ============================================
         TAB 4: HAND & ARM CONTROLS
         ============================================ -->
        <div class="tab-content" id="tab-hands">
                <div class="panel">
                        <div class="panel-title">üñêÔ∏è Hand Control</div>
                        <div class="grid-2">
                                <div>
                                        <div class="hand-section-label left">LEFT HAND</div>
                                        <div style="display:flex;flex-direction:column;gap:8px">
                                                <button class="btn btn-cyan" onclick="controlHand('LC')">üëê
                                                        Open</button>
                                                <button class="btn btn-cyan" onclick="controlHand('LO')">‚úä
                                                        Close</button>
                                        </div>
                                </div>
                                <div>
                                        <div class="hand-section-label right">RIGHT HAND</div>
                                        <div style="display:flex;flex-direction:column;gap:8px">
                                                <button class="btn btn-green" onclick="controlHand('RC')">üëê
                                                        Open</button>
                                                <button class="btn btn-green" onclick="controlHand('RO')">‚úä
                                                        Close</button>
                                        </div>
                                </div>
                        </div>
                </div>

                <div class="panel">
                        <div class="panel-title">üîÑ Wrist Control</div>
                        <div class="slider-group">
                                <div class="slider-label">
                                        <span style="color:#00d4ff">LEFT WRIST</span>
                                        <span class="angle-display" id="leftAngle">90¬∞</span>
                                </div>
                                <input type="range" min="0" max="180" value="90" class="slider" id="leftWrist"
                                        oninput="updateWrist('L', this.value)">
                        </div>
                        <div class="slider-group">
                                <div class="slider-label">
                                        <span style="color:#00ff88">RIGHT WRIST</span>
                                        <span class="angle-display" id="rightAngle">90¬∞</span>
                                </div>
                                <input type="range" min="0" max="180" value="90" class="slider" id="rightWrist"
                                        oninput="updateWrist('R', this.value)">
                        </div>
                </div>

                <div class="panel">
                        <div class="panel-title">üí™ Bicep Control</div>
                        <div class="grid-2">
                                <div>
                                        <div class="hand-section-label left">LEFT BICEP</div>
                                        <div style="display:flex;flex-direction:column;gap:8px">
                                                <button class="btn btn-cyan" onclick="controlBicep('BLU')">‚¨ÜÔ∏è
                                                        Up</button>
                                                <button class="btn btn-cyan" onclick="controlBicep('BLD')">‚¨áÔ∏è
                                                        Down</button>
                                        </div>
                                </div>
                                <div>
                                        <div class="hand-section-label right">RIGHT BICEP</div>
                                        <div style="display:flex;flex-direction:column;gap:8px">
                                                <button class="btn btn-green" onclick="controlBicep('BRU')">‚¨ÜÔ∏è
                                                        Up</button>
                                                <button class="btn btn-green" onclick="controlBicep('BRD')">‚¨áÔ∏è
                                                        Down</button>
                                        </div>
                                </div>
                        </div>
                        <button class="emergency-stop mt-12" onclick="controlBicep('BS')">üõë STOP BICEPS</button>
                </div>

                <div class="panel">
                        <div class="status-display" id="handStatus">
                                <strong>Ready to control hands & arms</strong>
                        </div>
                        <button class="emergency-stop mt-12" onclick="emergencyStop()">üõë EMERGENCY STOP ALL</button>
                </div>
        </div>

        <!-- ============================================
         TAB 5: MODEL TRAINING
         ============================================ -->
        <div class="tab-content" id="tab-training">
                <div class="panel">
                        <div class="panel-title">üß† AI Model Training</div>
                        <p style="font-size: 12px; opacity: 0.5; margin-bottom: 14px;">
                                Train NAVIS to answer questions about specific topics. Add question-answer pairs below.
                        </p>

                        <div class="train-form">
                                <textarea id="trainQuestion"
                                        placeholder="Question (e.g., Who is the CEO of Robomanthan?)"
                                        rows="2"></textarea>
                                <textarea id="trainAnswer"
                                        placeholder="Answer (e.g., The CEO of Robomanthan is Mr. Saurav Kumar)"
                                        rows="2"></textarea>
                                <button class="btn btn-fill-gold" onclick="addTrainingPair()">üß† Train Model</button>
                        </div>
                </div>

                <div class="panel">
                        <div class="panel-title">üìö Knowledge Base</div>
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                                <span style="font-size:12px;opacity:0.5" id="pairCount">Loading...</span>
                                <button class="btn btn-gold" style="padding:6px 12px;font-size:11px"
                                        onclick="reloadTraining()">üîÑ Reload</button>
                        </div>
                        <div class="training-list" id="trainingList">
                                <div class="text-center" style="padding:20px;opacity:0.3">Loading training data...</div>
                        </div>
                </div>
        </div>

        <!-- FLOATING EMERGENCY STOP (visible on all tabs) -->
        <button class="global-emergency" onclick="emergencyStop()" title="EMERGENCY STOP">üõë</button>

        <!-- ============================================
         JAVASCRIPT
         ============================================ -->
        <script>
                let mediaRecorder;
                let audioChunks = [];
                const micBtn = document.getElementById('micBtn');
                const chatMessages = document.getElementById('chatMessages');
                const followStatus = document.getElementById('followStatus');
                const stopSpeakingBtn = document.getElementById('stopSpeakingBtn');

                // ============================================
                //   WEB SPEECH API (Text-to-Speech)
                // ============================================
                const synth = window.speechSynthesis;
                let isSpeaking = false;

                function speakText(text) {
                        synth.cancel();
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.rate = 1.0;
                        utterance.pitch = 1.0;
                        utterance.volume = 1.0;

                        const voices = synth.getVoices();
                        const preferred = voices.find(v => v.name.includes('Google') && v.lang.startsWith('en'))
                                || voices.find(v => v.lang.startsWith('en'));
                        if (preferred) utterance.voice = preferred;

                        utterance.onstart = () => {
                                isSpeaking = true;
                                stopSpeakingBtn.classList.add('visible');
                                const indicators = chatMessages.querySelectorAll('.chat-msg.bot:last-of-type .msg-label');
                                const last = indicators[indicators.length - 1];
                                if (last && !last.querySelector('.speaking-indicator')) {
                                        last.innerHTML += '<span class="speaking-indicator">üîä</span>';
                                }
                        };

                        utterance.onend = () => {
                                isSpeaking = false;
                                stopSpeakingBtn.classList.remove('visible');
                                document.querySelectorAll('.speaking-indicator').forEach(el => el.remove());
                        };

                        utterance.onerror = () => {
                                isSpeaking = false;
                                stopSpeakingBtn.classList.remove('visible');
                                document.querySelectorAll('.speaking-indicator').forEach(el => el.remove());
                        };

                        synth.speak(utterance);
                }

                function stopSpeaking() {
                        synth.cancel();
                        isSpeaking = false;
                        stopSpeakingBtn.classList.remove('visible');
                        document.querySelectorAll('.speaking-indicator').forEach(el => el.remove());
                }

                if (synth.onvoiceschanged !== undefined) {
                        synth.onvoiceschanged = () => synth.getVoices();
                }

                // ============================================
                //   CHAT MESSAGE MANAGEMENT
                // ============================================
                function addChatMessage(type, label, text) {
                        const msg = document.createElement('div');
                        msg.className = `chat-msg ${type}`;
                        msg.innerHTML = `<div class="msg-label">${label}</div>${text}`;
                        chatMessages.appendChild(msg);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function addLoadingMessage() {
                        const msg = document.createElement('div');
                        msg.className = 'chat-msg bot';
                        msg.id = 'loading-msg';
                        msg.innerHTML = '<div class="msg-label">ü§ñ NAVIS</div><div class="spinner"></div> Thinking...';
                        chatMessages.appendChild(msg);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                }

                function removeLoadingMessage() {
                        const el = document.getElementById('loading-msg');
                        if (el) el.remove();
                }

                // ============================================
                //   TAB SWITCHING
                // ============================================
                function switchTab(tabName) {
                        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                        document.getElementById('tab-' + tabName).classList.add('active');
                        event.currentTarget.classList.add('active');
                        if (tabName === 'training') loadTrainingData();
                }

                // ============================================
                //   CONTINUOUS MOVEMENT
                // ============================================
                let moveInterval = null;

                function startMoving(cmd) {
                        if (event && event.type === 'touchstart') event.preventDefault();
                        sendCommand(cmd);
                        if (moveInterval) clearInterval(moveInterval);
                        moveInterval = setInterval(() => sendCommand(cmd), 100);
                }

                function stopMoving() {
                        if (moveInterval) { clearInterval(moveInterval); moveInterval = null; }
                        sendCommand('S');
                }

                // ============================================
                //   MICROPHONE
                // ============================================
                async function initMicrophone() {
                        try {
                                const stream = await navigator.mediaDevices.getUserMedia({
                                        audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true }
                                });
                                mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                                mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) audioChunks.push(e.data); };
                                mediaRecorder.onstop = async () => {
                                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                                        audioChunks = [];
                                        await sendAudio(audioBlob);
                                };
                        } catch (error) {
                                console.error('Mic error:', error);
                                addChatMessage('bot', 'ü§ñ NAVIS', '‚ùå Microphone access denied. Please allow microphone access.');
                        }
                }

                micBtn.addEventListener('mousedown', startRecording);
                micBtn.addEventListener('touchstart', startRecording);
                micBtn.addEventListener('mouseup', stopRecording);
                micBtn.addEventListener('touchend', stopRecording);

                function startRecording(e) {
                        e.preventDefault();
                        if (mediaRecorder && mediaRecorder.state === 'inactive') {
                                audioChunks = [];
                                mediaRecorder.start();
                                micBtn.classList.add('recording');
                                addChatMessage('bot', 'ü§ñ NAVIS', 'üé§ Listening...');
                        }
                }

                function stopRecording(e) {
                        e.preventDefault();
                        if (mediaRecorder && mediaRecorder.state === 'recording') {
                                mediaRecorder.stop();
                                micBtn.classList.remove('recording');
                        }
                }

                // ============================================
                //   API CALLS
                // ============================================
                async function sendAudio(audioBlob) {
                        const formData = new FormData();
                        formData.append('audio', audioBlob, 'recording.webm');

                        // Remove "Listening..." and show loading
                        const msgs = chatMessages.querySelectorAll('.chat-msg.bot');
                        if (msgs.length > 0) {
                                const lastMsg = msgs[msgs.length - 1];
                                if (lastMsg.textContent.includes('Listening...')) lastMsg.remove();
                        }
                        addLoadingMessage();

                        try {
                                const response = await fetch('/audio_upload', { method: 'POST', body: formData });
                                const result = await response.json();
                                removeLoadingMessage();

                                if (result.error) {
                                        addChatMessage('bot', 'ü§ñ NAVIS', `<span style="color:#ff6b6b">‚ùå ${result.error}</span>`);
                                } else {
                                        addChatMessage('user', 'üë§ You', result.transcription);
                                        addChatMessage('bot', 'ü§ñ NAVIS', result.response);
                                        speakText(result.response);
                                        updateFollowStatus(result.follow_active);
                                }
                        } catch (error) {
                                removeLoadingMessage();
                                addChatMessage('bot', 'ü§ñ NAVIS', '<span style="color:#ff6b6b">‚ùå Network error</span>');
                        }
                }

                async function sendCommand(cmd) {
                        try {
                                fetch('/manual_control', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ command: cmd })
                                }).catch(err => console.error(err));
                        } catch (error) { console.error(error); }
                }

                // ============================================
                //   GLOBAL EMERGENCY STOP
                // ============================================
                function emergencyStop() {
                        // Stop motors
                        stopMoving();
                        sendCommand('S');

                        // Stop follow mode
                        fetch('/text_chat', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ message: 'stop navis' })
                        }).catch(() => { });

                        // Stop biceps
                        fetch('/bicep_control', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ command: 'BS' })
                        }).catch(() => { });

                        // Stop TTS
                        stopSpeaking();

                        // Update follow state
                        updateFollowStatus(false);

                        // Update all status displays
                        const cs = document.getElementById('controlStatus');
                        if (cs) cs.innerHTML = '<strong style="color:#ff6b6b">üõë EMERGENCY STOP ‚Äî All systems halted</strong>';

                        const hs = document.getElementById('handStatus');
                        if (hs) hs.innerHTML = '<strong style="color:#ff6b6b">üõë EMERGENCY STOP</strong>';

                        const camS = document.getElementById('cameraStatus');
                        if (camS) camS.innerHTML = '<strong style="color:#ff6b6b">üõë EMERGENCY STOP ‚Äî Follow mode disabled</strong>';

                        // Flash the global button
                        const btn = document.querySelector('.global-emergency');
                        btn.style.animation = 'none';
                        btn.style.boxShadow = '0 0 40px rgba(220, 38, 38, 0.9)';
                        setTimeout(() => { btn.style.animation = ''; btn.style.boxShadow = ''; }, 1500);
                }

                // ============================================
                //   FOLLOW / STOP (Camera Tab)
                // ============================================
                async function toggleFollow(activate) {
                        const camStatus = document.getElementById('cameraStatus');
                        const followBtn = document.getElementById('followBtn');

                        if (activate) {
                                camStatus.innerHTML = '<div class="spinner"></div> <strong>Activating follow mode...</strong>';
                                try {
                                        const response = await fetch('/text_chat', {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify({ message: 'follow me navis' })
                                        });
                                        const result = await response.json();
                                        camStatus.innerHTML = `<strong style="color:#00ff88">üéØ ${result.response}</strong>`;
                                        followBtn.classList.add('active');
                                        updateFollowStatus(true);
                                } catch (error) {
                                        camStatus.innerHTML = '<strong style="color:#ff6b6b">‚ùå Failed to activate follow</strong>';
                                }
                        } else {
                                camStatus.innerHTML = '<div class="spinner"></div> <strong>Stopping...</strong>';
                                try {
                                        const response = await fetch('/text_chat', {
                                                method: 'POST',
                                                headers: { 'Content-Type': 'application/json' },
                                                body: JSON.stringify({ message: 'stop navis' })
                                        });
                                        const result = await response.json();
                                        sendCommand('S');
                                        camStatus.innerHTML = `<strong style="color:#ff6b6b">‚èπÔ∏è ${result.response}</strong>`;
                                        followBtn.classList.remove('active');
                                        updateFollowStatus(false);
                                } catch (error) {
                                        camStatus.innerHTML = '<strong style="color:#ff6b6b">‚ùå Failed to stop</strong>';
                                }
                        }
                }

                // ============================================
                //   TEXT CHAT (with voice reply)
                // ============================================
                async function sendText() {
                        const input = document.getElementById('textInput');
                        const text = input.value.trim();
                        if (!text) return;
                        input.value = '';

                        addChatMessage('user', 'üë§ You', text);
                        addLoadingMessage();

                        try {
                                const response = await fetch('/text_chat', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ message: text })
                                });
                                const result = await response.json();
                                removeLoadingMessage();
                                addChatMessage('bot', 'ü§ñ NAVIS', result.response);
                                speakText(result.response);
                                updateFollowStatus(result.follow_active);
                        } catch (error) {
                                removeLoadingMessage();
                                addChatMessage('bot', 'ü§ñ NAVIS', '<span style="color:#ff6b6b">‚ùå Error sending message</span>');
                        }
                }

                document.getElementById('textInput').addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') sendText();
                });

                // ============================================
                //   HAND / WRIST / BICEP CONTROLS
                // ============================================
                const handStatus = document.getElementById('handStatus');

                async function controlHand(command) {
                        handStatus.innerHTML = '<div class="spinner"></div> Sending...';
                        try {
                                const res = await fetch('/hand_control', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ command })
                                });
                                const r = await res.json();
                                handStatus.innerHTML = r.success
                                        ? `<strong style="color:#00ff88">‚úÖ ${r.message}</strong>`
                                        : `<strong style="color:#ff6b6b">‚ùå ${r.error}</strong>`;
                        } catch (e) {
                                handStatus.innerHTML = '<strong style="color:#ff6b6b">‚ùå Connection error</strong>';
                        }
                }

                let wristTimeout = null;
                function updateWrist(side, angle) {
                        const display = side === 'L' ? document.getElementById('leftAngle') : document.getElementById('rightAngle');
                        display.textContent = angle + '¬∞';
                        clearTimeout(wristTimeout);
                        wristTimeout = setTimeout(() => sendWristCommand(side, angle), 150);
                }

                async function sendWristCommand(side, angle) {
                        try {
                                const res = await fetch('/wrist_control', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ side, angle })
                                });
                                const r = await res.json();
                                handStatus.innerHTML = r.success
                                        ? `<strong style="color:#00ff88">‚úÖ ${r.message}</strong>`
                                        : `<strong style="color:#ff6b6b">‚ùå ${r.error}</strong>`;
                        } catch (e) {
                                handStatus.innerHTML = '<strong style="color:#ff6b6b">‚ùå Connection error</strong>';
                        }
                }

                async function controlBicep(command) {
                        handStatus.innerHTML = '<div class="spinner"></div> Sending...';
                        try {
                                const res = await fetch('/bicep_control', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ command })
                                });
                                const r = await res.json();
                                handStatus.innerHTML = r.success
                                        ? `<strong style="color:#00ff88">‚úÖ ${r.message}</strong>`
                                        : `<strong style="color:#ff6b6b">‚ùå ${r.error}</strong>`;
                        } catch (e) {
                                handStatus.innerHTML = '<strong style="color:#ff6b6b">‚ùå Connection error</strong>';
                        }
                }

                // ============================================
                //   PERSON TRAINING
                // ============================================
                async function captureView(view) {
                        const camS = document.getElementById('cameraStatus');
                        camS.innerHTML = `<div class="spinner"></div> <strong>Capturing ${view} view...</strong>`;
                        try {
                                const res = await fetch('/capture_person', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ view })
                                });
                                const r = await res.json();
                                camS.innerHTML = r.success
                                        ? `<strong style="color:#00ff88">‚úÖ ${r.message}</strong>`
                                        : `<strong style="color:#ff6b6b">‚ùå ${r.error}</strong>`;
                                updatePersonStatus();
                        } catch (e) {
                                camS.innerHTML = '<strong style="color:#ff6b6b">‚ùå Capture failed</strong>';
                        }
                }

                async function uploadPhoto(view) {
                        const fileInput = view === 'front' ? document.getElementById('photoUploadFront') : document.getElementById('photoUploadBack');
                        const file = fileInput.files[0];
                        if (!file) return;

                        const formData = new FormData();
                        formData.append('photo', file);
                        formData.append('view', view);
                        const camS = document.getElementById('cameraStatus');

                        try {
                                const res = await fetch('/upload_person_photo', { method: 'POST', body: formData });
                                const r = await res.json();
                                camS.innerHTML = r.success
                                        ? `<strong style="color:#00ff88">‚úÖ ${r.message}</strong>`
                                        : `<strong style="color:#ff6b6b">‚ùå ${r.error}</strong>`;
                                updatePersonStatus();
                        } catch (e) {
                                camS.innerHTML = '<strong style="color:#ff6b6b">‚ùå Upload failed</strong>';
                        }
                        fileInput.value = '';
                }

                async function clearPerson() {
                        if (!confirm('Clear all person training data?')) return;
                        const camS = document.getElementById('cameraStatus');
                        try {
                                const res = await fetch('/clear_person', { method: 'POST' });
                                const r = await res.json();
                                camS.innerHTML = `<strong>‚úÖ ${r.message}</strong>`;
                                updatePersonStatus();
                        } catch (e) {
                                camS.innerHTML = '<strong style="color:#ff6b6b">‚ùå Clear failed</strong>';
                        }
                }

                async function updatePersonStatus() {
                        try {
                                const res = await fetch('/person_status');
                                const data = await res.json();
                                const ts = document.getElementById('trainingStatus');
                                const vl = document.getElementById('viewsList');
                                if (data.enrolled) {
                                        ts.className = 'training-status enrolled';
                                        ts.innerHTML = `‚úÖ ${data.name} Enrolled`;
                                        vl.innerHTML = `Views: ${data.views.join(', ')} (${data.total_views} total)`;
                                } else {
                                        ts.className = 'training-status not-enrolled';
                                        ts.innerHTML = '‚ö†Ô∏è No person enrolled';
                                        vl.innerHTML = '';
                                }
                        } catch (e) { console.error(e); }
                }

                // ============================================
                //   CAMERA CONTROLS
                // ============================================
                async function toggleFaceDetection() {
                        try {
                                const res = await fetch('/toggle_face_detection', { method: 'POST' });
                                const r = await res.json();
                                const btn = document.getElementById('faceDetectBtn');
                                if (r.enabled) {
                                        btn.classList.add('btn-fill-gold');
                                        btn.classList.remove('btn-gold');
                                } else {
                                        btn.classList.remove('btn-fill-gold');
                                        btn.classList.add('btn-gold');
                                }
                        } catch (e) { console.error(e); }
                }

                // ============================================
                //   MODEL TRAINING
                // ============================================
                async function addTrainingPair() {
                        const q = document.getElementById('trainQuestion').value.trim();
                        const a = document.getElementById('trainAnswer').value.trim();
                        if (!q || !a) return alert('Please fill in both question and answer.');

                        try {
                                const res = await fetch('/train_model', {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ question: q, answer: a })
                                });
                                const r = await res.json();
                                if (r.success) {
                                        document.getElementById('trainQuestion').value = '';
                                        document.getElementById('trainAnswer').value = '';
                                        loadTrainingData();
                                        alert('‚úÖ Training pair added!');
                                } else {
                                        alert('‚ùå ' + r.error);
                                }
                        } catch (e) {
                                alert('‚ùå Failed to add training pair');
                        }
                }

                async function loadTrainingData() {
                        try {
                                const res = await fetch('/training_data');
                                const data = await res.json();
                                const list = document.getElementById('trainingList');
                                const count = document.getElementById('pairCount');
                                count.textContent = `${data.total} knowledge pairs`;

                                if (data.pairs.length === 0) {
                                        list.innerHTML = '<div class="text-center" style="padding:20px;opacity:0.3">No training data yet</div>';
                                        return;
                                }

                                list.innerHTML = data.pairs.map((p, i) => `
                    <div class="training-pair">
                        <div class="pair-content">
                            <div class="pair-q">Q: ${p.question}</div>
                            <div class="pair-a">A: ${p.answer.substring(0, 80)}${p.answer.length > 80 ? '...' : ''}</div>
                        </div>
                        <button class="delete-pair" onclick="deleteTrainingPair(${i})" title="Delete">‚úï</button>
                    </div>
                `).join('');
                        } catch (e) {
                                console.error(e);
                        }
                }

                async function deleteTrainingPair(index) {
                        if (!confirm('Delete this training pair?')) return;
                        try {
                                await fetch(`/training_data/${index}`, { method: 'DELETE' });
                                loadTrainingData();
                        } catch (e) { console.error(e); }
                }

                async function reloadTraining() {
                        try {
                                await fetch('/reload_training', { method: 'POST' });
                                loadTrainingData();
                        } catch (e) { console.error(e); }
                }

                // ============================================
                //   STATUS UPDATES
                // ============================================
                function updateFollowStatus(isActive) {
                        const followBtn = document.getElementById('followBtn');
                        if (isActive) {
                                followStatus.classList.remove('inactive');
                                followStatus.classList.add('active');
                                followStatus.innerHTML = '‚úÖ FOLLOW';
                                if (followBtn) followBtn.classList.add('active');
                        } else {
                                followStatus.classList.remove('active');
                                followStatus.classList.add('inactive');
                                followStatus.innerHTML = '‚è∏Ô∏è MANUAL';
                                if (followBtn) followBtn.classList.remove('active');
                        }
                }

                setInterval(async () => {
                        try {
                                const res = await fetch('/status');
                                const data = await res.json();
                                updateFollowStatus(data.follow_active);
                        } catch (e) { }
                }, 3000);

                setInterval(updatePersonStatus, 5000);

                // Init
                initMicrophone();
                updatePersonStatus();
        </script>
</body>

</html>

